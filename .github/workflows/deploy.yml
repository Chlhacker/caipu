name: éƒ¨ç½²åˆ°è…¾è®¯äº‘ CloudBase

on:
  push:
    branches:
      - main  # ä¸»åˆ†æ”¯æ¨é€æ—¶è‡ªåŠ¨éƒ¨ç½²
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘éƒ¨ç½²

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¦ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: ğŸ”§ å®‰è£… CloudBase CLI
        run: npm install -g @cloudbase/cli
      
      - name: ğŸ” ç™»å½• CloudBase
        run: tcb login --apiKeyId ${{ secrets.TCB_SECRET_ID }} --apiKey ${{ secrets.TCB_SECRET_KEY }}
      
      - name: ğŸš€ éƒ¨ç½²åˆ°é™æ€æ‰˜ç®¡
        run: tcb hosting deploy . / -e ${{ secrets.TCB_ENV_ID }}
      
      - name: âœ… éƒ¨ç½²æˆåŠŸé€šçŸ¥
        if: success()
        run: |
          echo "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼"
          echo "ğŸ“± è®¿é—®æ‚¨çš„ CloudBase é™æ€æ‰˜ç®¡åŸŸåæŸ¥çœ‹æ•ˆæœ"
          echo "â° éƒ¨ç½²æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
      
      - name: âŒ éƒ¨ç½²å¤±è´¥é€šçŸ¥
        if: failure()
        run: |
          echo "ğŸ’” éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®å’Œæ—¥å¿—"
          echo "ğŸ“‹ å¸¸è§é—®é¢˜ï¼š"
          echo "  1. æ£€æŸ¥ GitHub Secrets æ˜¯å¦é…ç½®æ­£ç¡®"
          echo "  2. æ£€æŸ¥ CloudBase ç¯å¢ƒ ID æ˜¯å¦æ­£ç¡®"
          echo "  3. æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ"
