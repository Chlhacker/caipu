# 🚀 自动保存功能使用指南

## ✅ 已完成的功能

现在应用支持**自动保存到 data.json**！

当用户进行以下操作时，数据会自动保存：
- ✅ 添加/编辑/删除菜品
- ✅ 创建/完成订单
- ✅ 添加/删除心愿

---

## 📦 安装步骤

### 1. 安装 Node.js（如果还没有）

访问 https://nodejs.org/ 下载并安装 LTS 版本

### 2. 安装依赖

在项目目录下运行：

```bash
cd d:\code\caipu
npm install
```

这会安装：
- `express`：Web 服务器框架
- `cors`：跨域支持

---

## 🎯 启动服务

### Windows 系统

**方法 1：使用 npm 命令**
```bash
npm start
```

**方法 2：直接运行**
```bash
node server.js
```

**方法 3：创建快捷启动脚本**

创建 `启动服务.bat` 文件：
```bat
@echo off
cd /d d:\code\caipu
node server.js
pause
```

双击运行即可。

### 启动成功提示

```
╔════════════════════════════════════════╗
║   🍳 崔宝的御膳房 - 数据服务已启动    ║
╠════════════════════════════════════════╣
║  本地访问: http://localhost:3000       ║
║  局域网访问: http://[IP地址]:3000      ║
╠════════════════════════════════════════╣
║  API 接口:                             ║
║  - POST /api/save-data  保存数据       ║
║  - GET  /api/get-data   获取数据       ║
╚════════════════════════════════════════╝
```

---

## 🌐 访问应用

### 本地访问（同一台电脑）

打开浏览器访问：
```
http://localhost:3000
```

### 局域网访问（手机/其他设备）

1. **查看电脑 IP 地址**
   - Windows：运行 `ipconfig`，找到 IPv4 地址
   - 例如：`192.168.1.100`

2. **手机连接同一 WiFi**

3. **访问地址**
   ```
   http://192.168.1.100:3000
   ```

---

## 🔧 工作原理

### 数据流程

```
用户操作 → localStorage（本地缓存）
          ↓
    1秒后自动触发
          ↓
    发送到后端 API
          ↓
   自动保存到 data.json
          ↓
   其他设备刷新页面即可看到
```

### 防抖机制

- 用户连续操作时，**1秒后**才发送保存请求
- 避免频繁请求服务器
- 优化性能

### 离线工作

- 如果服务器未启动，数据仍保存在 localStorage
- 不会影响用户正常使用
- 控制台会提示："无法连接到服务器，数据仅保存在本地"

---

## 📱 多设备同步

### 场景 1：电脑添加菜品，手机查看

1. **电脑端**：
   - 添加菜品
   - 数据自动保存到 `data.json`
   - 控制台显示："✅ 数据已自动保存到 data.json"

2. **手机端**：
   - 刷新页面（F5 或下拉刷新）
   - 自动从 `data.json` 加载最新数据
   - 看到新添加的菜品

### 场景 2：多人同时使用

1. **A 设备**添加菜品 → 自动保存
2. **B 设备**刷新页面 → 看到 A 的更新
3. **B 设备**修改数据 → 自动保存
4. **A 设备**刷新页面 → 看到 B 的更新

---

## 🛠️ 故障排查

### 问题 1：服务启动失败

**可能原因**：端口 3000 被占用

**解决方案**：
1. 修改 `server.js` 中的 `PORT = 3000` 为其他端口（如 `3001`）
2. 修改 `index.html` 中的 API 地址为新端口

### 问题 2：手机无法访问

**检查清单**：
- ✅ 电脑和手机连接同一 WiFi
- ✅ 关闭电脑防火墙或允许 Node.js 通过防火墙
- ✅ IP 地址正确
- ✅ 端口号正确（:3000）

### 问题 3：数据没有自动保存

**检查步骤**：
1. 打开浏览器控制台（F12）
2. 查看是否有错误信息
3. 确认服务器正在运行
4. 查看服务器终端是否有保存日志

---

## 📊 服务器日志

### 正常保存日志示例

```
✅ 数据已保存 - 2025/11/27 15:30:45
   菜品: 15 道
   订单: 5 个
   心愿: 2 个
```

### 错误日志示例

```
❌ 保存失败: Error: ...
```

---

## 🎉 优势总结

### ✅ 自动化
- 无需手动导出
- 无需手动替换文件
- 用户无感知操作

### ✅ 实时同步
- 数据立即保存
- 其他设备刷新即可获取
- 真正的多设备协同

### ✅ 容错性
- 服务器未启动时，数据保存在本地
- 网络断开不影响使用
- 服务器恢复后自动保存

### ✅ 性能优化
- 防抖机制，避免频繁请求
- 1秒延迟，批量保存
- 静默保存，不影响体验

---

## 📌 注意事项

### 1. 保持服务运行

使用应用时，需要保持 `server.js` 运行

### 2. 备份数据

虽然有自动保存，仍建议定期导出备份

### 3. Git 管理

`data.json` 会自动更新，记得提交到 Git：
```bash
git add data.json
git commit -m "更新菜品数据"
git push
```

### 4. 并发冲突

多人同时修改可能导致覆盖，建议：
- 指定主要编辑者
- 其他人只查看
- 或协调编辑时间

---

## 🔄 与旧版本对比

| 特性 | 旧版本 | 新版本（自动保存）|
|------|--------|------------------|
| 保存方式 | 手动导出 | 自动保存 |
| 操作步骤 | 5步 | 0步 |
| 同步速度 | 需手动操作 | 1秒自动 |
| 用户体验 | 繁琐 | 无感知 |
| 多设备同步 | 需Git操作 | 刷新即可 |

---

现在开始使用吧！🎉
